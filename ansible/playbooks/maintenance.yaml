---
# Maintenance playbook for Jenkins server

- name: Jenkins Server Maintenance
  hosts: tag_Project_CloudDevOpsProject
  gather_facts: yes
  become: yes
  vars_files:
    - ../group_vars/all.yaml 

  tasks:
    - name: Update all packages
      yum:
        name: '*'
        state: latest
        update_cache: yes
      when: update_packages | default(false) | bool
      tags:
        - updates

    - name: Clean Docker system
      command: docker system prune -af --volumes
      when: clean_docker | default(false) | bool
      tags:
        - docker
        - cleanup

    - name: Restart Docker service
      systemd:
        name: docker
        state: restarted
      when: restart_docker | default(false) | bool
      tags:
        - docker
        - restart

    - name: Restart Jenkins service
      systemd:
        name: jenkins
        state: restarted
      when: restart_jenkins | default(false) | bool
      tags:
        - jenkins
        - restart

    - name: Check disk space
      shell: df -h
      register: disk_space
      changed_when: false
      tags:
        - info

    - name: Display disk space
      debug:
        var: disk_space.stdout_lines
      tags:
        - info

    - name: Check Jenkins logs
      command: journalctl -u jenkins -n 50 --no-pager
      register: jenkins_logs
      changed_when: false
      tags:
        - logs

    - name: Display Jenkins logs
      debug:
        var: jenkins_logs.stdout_lines
      tags:
        - logs

